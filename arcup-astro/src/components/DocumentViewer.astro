---
interface Props {
  title: string;
  date: string;
  description?: string;
  filePath: string;
  fileName: string;
  fileSize?: string;
  fileType?: string;
}

const {
  title,
  date,
  description,
  filePath,
  fileName,
  fileSize,
  fileType = "PDF"
} = Astro.props;

const withBase = (path: string) => {
  const base = '/arcup';
  if (path === '/') return `${base}/`;
  return `${base}${path}`;
};
---

<div class="document-viewer">
  <!-- Document Header -->
  <header class="document-header">
    <div class="document-meta">
      <h1 class="document-title">{title}</h1>
      <div class="document-details">
        <span class="document-date">Published: {date}</span>
        {fileSize && <span class="document-size">Size: {fileSize}</span>}
        <span class="document-type">Type: {fileType}</span>
      </div>
    </div>
    
    <div class="document-actions">
      <a 
        href={filePath} 
        download={fileName}
        class="button button-primary download-button"
        target="_blank"
        rel="noopener noreferrer"
      >
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
          <polyline points="7,10 12,15 17,10"/>
          <line x1="12" y1="15" x2="12" y2="3"/>
        </svg>
        <span>Download {fileType}</span>
      </a>
    </div>
  </header>

  <!-- Document Description -->
  {description && (
    <div class="document-description">
      <p>{description}</p>
    </div>
  )}

  <!-- Document Viewer -->
  <div class="document-container">
    <div class="document-viewer-wrapper">
      <iframe 
        src={filePath}
        class="document-iframe"
        title={`${title} - Document Viewer`}
        loading="lazy"
      />
    </div>
  </div>

  <!-- Document Footer -->
  <footer class="document-footer">
    <div class="document-footer-content">
      <p class="document-note">
        <strong>Note:</strong> This document is part of Arc^'s open documentation. 
        For questions or clarifications, please <a href={withBase("/join")}>contact us</a>.
      </p>
      <div class="document-license">
        <p>Licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener noreferrer">CC BY-NC-SA 4.0</a></p>
      </div>
    </div>
  </footer>
</div>

<style>
  .document-viewer {
    max-width: 100ch;
    margin: 0 auto;
    padding: clamp(2rem, 5vw, 3rem) clamp(1.5rem, 4vw, 2rem);
  }

  /* Document Header */
  .document-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 2rem;
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid rgba(93, 225, 228, 0.2);
  }

  .document-meta {
    flex: 1;
  }

  .document-title {
    margin: 0 0 1rem 0;
    font-size: clamp(1.8rem, 4.5vw, 2.4rem);
    font-weight: 600;
    color: var(--color-text);
    line-height: 1.2;
  }

  .document-details {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    font-size: 0.95rem;
    color: var(--color-text-muted);
  }

  .document-date,
  .document-size,
  .document-type {
    padding: 0.25rem 0.75rem;
    background: rgba(10, 147, 150, 0.1);
    border: 1px solid rgba(93, 225, 228, 0.2);
    border-radius: 6px;
    font-size: 0.85rem;
  }

  .document-actions {
    flex-shrink: 0;
  }

  .download-button {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    white-space: nowrap;
  }

  /* Document Description */
  .document-description {
    margin-bottom: 2rem;
    padding: 1.5rem;
    background: rgba(10, 147, 150, 0.08);
    border: 1px solid rgba(93, 225, 228, 0.2);
    border-radius: var(--radius-lg);
  }

  .document-description p {
    margin: 0;
    font-size: 1.05rem;
    color: var(--color-text-muted);
    line-height: 1.7;
  }

  /* Document Container */
  .document-container {
    margin-bottom: 2rem;
    border: 1px solid rgba(93, 225, 228, 0.2);
    border-radius: var(--radius-lg);
    overflow: hidden;
    background: white;
    box-shadow: var(--shadow-soft);
  }

  .document-viewer-wrapper {
    position: relative;
    width: 100%;
    height: 80vh;
    min-height: 600px;
  }

  .document-iframe {
    width: 100%;
    height: 100%;
    border: none;
    background: white;
  }

  /* Document Footer */
  .document-footer {
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid rgba(93, 225, 228, 0.2);
  }

  .document-footer-content {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 2rem;
  }

  .document-note {
    margin: 0;
    font-size: 0.95rem;
    color: var(--color-text-muted);
    line-height: 1.6;
  }

  .document-note strong {
    color: var(--color-text);
  }

  .document-note a {
    color: var(--color-primary-bright);
    text-decoration: underline;
    text-decoration-color: rgba(93, 225, 228, 0.3);
    transition: text-decoration-color var(--transition-base);
  }

  .document-note a:hover {
    text-decoration-color: var(--color-primary-bright);
  }

  .document-license {
    flex-shrink: 0;
  }

  .document-license p {
    margin: 0;
    font-size: 0.85rem;
    color: var(--color-text-muted);
  }

  .document-license a {
    color: var(--color-primary-bright);
    text-decoration: underline;
    text-decoration-color: rgba(93, 225, 228, 0.3);
    transition: text-decoration-color var(--transition-base);
  }

  .document-license a:hover {
    text-decoration-color: var(--color-primary-bright);
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .document-viewer {
      padding: 1.5rem 1rem;
    }

    .document-header {
      flex-direction: column;
      gap: 1.5rem;
    }

    .document-actions {
      width: 100%;
    }

    .download-button {
      width: 100%;
      justify-content: center;
    }

    .document-details {
      flex-direction: column;
      gap: 0.5rem;
    }

    .document-viewer-wrapper {
      height: 60vh;
      min-height: 400px;
    }

    .document-footer-content {
      flex-direction: column;
      gap: 1rem;
    }
  }

  @media (max-width: 480px) {
    .document-viewer {
      padding: 1rem 0.75rem;
    }

    .document-viewer-wrapper {
      height: 50vh;
      min-height: 300px;
    }
  }
</style>
